<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            overflow: hidden;
        }

        /* --- CENTER DISPLAY --- */
        #center-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        #display {
            font-size: 150px; 
            font-weight: bold;
            user-select: none;
            text-align: center;
            line-height: 1;
            transition: color 0.1s;
        }

        /* --- DYNAMIC WIDTH INPUT --- */
        #slideLabel {
            background: transparent;
            border-bottom: 2px solid #333; 
            color: #ddd;
            font-size: 50px; 
            text-align: center;
            outline: none;
            font-family: inherit;
            padding-bottom: 5px;
            min-width: 50px; 
            display: inline-block;
            transition: border-color 0.2s;
            cursor: text;
        }

        #slideLabel:focus {
            border-bottom: 2px solid #fff; 
        }

        /* --- SETTINGS MENU --- */
        #menu-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }

        #gear-btn {
            background: transparent;
            color: #555;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        #gear-btn:hover { color: #fff; }

        #controls-panel {
            display: none;
            margin-top: 10px;
            background: #111;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            flex-direction: column;
            gap: 15px;
            width: 200px;
        }

        #controls-panel.active { display: flex; }

        button.action-btn {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            background: #000;
            color: #ddd;
            border: 1px solid #444;
            border-radius: 4px;
        }
        button.action-btn:hover { background: #222; }

        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; color: #888; }
        
        input[type=range] { width: 100%; cursor: pointer; accent-color: #888; }
        
        #mode-status { color: #aaa; font-size: 13px; font-weight: bold; }
        
        /* New Reset Button Style */
        #clear-data-btn {
            margin-top: 10px;
            color: #ff4444;
            border-color: #552222;
        }
        #clear-data-btn:hover { background: #331111; }

    </style>
</head>
<body>

    <div id="menu-container">
        <button id="gear-btn" onclick="toggleMenu()">âš™</button>
        
        <div id="controls-panel">
            <div class="control-group">
                <div id="mode-status">Mode: Slide Numbers</div>
                <button class="action-btn" onclick="toggleMode()">Switch Mode</button>
            </div>
            
            <div class="control-group">
                <label>Size Adjustment</label>
                <input type="range" min="50" max="400" value="150" oninput="updateSize(this.value)">
            </div>

            <button id="clear-data-btn" class="action-btn" onclick="clearAllData()">Reset All Data</button>
        </div>
    </div>

    <div id="center-container">
        <div id="display">0</div>
        <span id="slideLabel" contenteditable="true" role="textbox"></span>
    </div>

    <script>
        // --- DATA STORAGE & AUTO-SAVE ---
        
        // 1. Try to load from browser memory
        const savedData = localStorage.getItem('slideTrackerData');
        
        // 2. Set state to saved data OR default empty state
        let state = savedData ? JSON.parse(savedData) : {
            NUM: { count: 0, memory: {} },
            PULSE: { count: 0, memory: {} }
        };

        // 3. Save function
        function saveData() {
            localStorage.setItem('slideTrackerData', JSON.stringify(state));
        }

        // --- SETUP ---
        let currentMode = 'NUM'; 
        let timeoutHandle = null;

        const display = document.getElementById('display');
        const slideLabel = document.getElementById('slideLabel');
        const modeStatus = document.getElementById('mode-status');
        const controlsPanel = document.getElementById('controls-panel');

        updateDisplay(); 

        // --- MENU LOGIC ---
        function toggleMenu() { controlsPanel.classList.toggle('active'); }

        // --- INPUT LOGIC ---
        slideLabel.addEventListener('input', (e) => {
            state[currentMode].memory[state[currentMode].count] = slideLabel.textContent;
            saveData(); // Auto-save on typing
        });

        slideLabel.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                slideLabel.blur();
            }
        });

        // --- NAVIGATION LOGIC ---
        function handleNav(direction) {
            const activeState = state[currentMode];

            if (direction === 'forward') {
                activeState.count++;
                if (currentMode === 'PULSE') triggerFlash(">>>");
            } 
            else if (direction === 'backward') {
                if (activeState.count > 0) {
                    activeState.count--;
                    if (currentMode === 'PULSE') triggerFlash("<<<");
                }
            }

            saveData(); // Auto-save on navigation
            updateDisplay();
        }

        function updateDisplay() {
            const activeState = state[currentMode];
            slideLabel.textContent = activeState.memory[activeState.count] || "";

            if (currentMode === 'NUM') {
                display.textContent = activeState.count;
                display.style.color = "white";
            } 
            else if (!timeoutHandle) {
                display.textContent = "---";
                display.style.color = "#333";
            }
        }

        function triggerFlash(symbol) {
            if (timeoutHandle) clearTimeout(timeoutHandle);
            display.textContent = symbol;
            display.style.color = "white"; 
            timeoutHandle = setTimeout(() => {
                display.textContent = "---";
                display.style.color = "#333"; 
                timeoutHandle = null;
            }, 500);
        }

        function toggleMode() {
            currentMode = (currentMode === 'NUM') ? 'PULSE' : 'NUM';
            modeStatus.textContent = (currentMode === 'NUM') ? "Mode: Slide Numbers" : "Mode: Forward/Backward";
            if(timeoutHandle) { clearTimeout(timeoutHandle); timeoutHandle = null; }
            updateDisplay();
        }

        function updateSize(val) {
            display.style.fontSize = val + "px";
            slideLabel.style.fontSize = (val * 0.4) + "px";
        }

        // New function to wipe memory if you want to start fresh
        function clearAllData() {
            if(confirm("Are you sure you want to reset all numbers and text?")) {
                state = { NUM: { count: 0, memory: {} }, PULSE: { count: 0, memory: {} } };
                saveData();
                updateDisplay();
            }
        }

        // --- GLOBAL KEY LISTENER ---
        document.addEventListener('keydown', e => {
            if (document.activeElement === slideLabel) {
                if (e.key === 'ArrowUp') { e.preventDefault(); handleNav('forward'); }
                else if (e.key === 'ArrowDown') { e.preventDefault(); handleNav('backward'); }
                return; 
            }

            if(e.key === 'ArrowUp' || e.key === 'ArrowRight') handleNav('forward');
            else if(e.key === 'ArrowDown' || e.key === 'ArrowLeft') handleNav('backward');
        });

    </script>
</body>
</html>