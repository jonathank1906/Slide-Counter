<!DOCTYPE html>
<html>
<head>
    <style>
        /* --- LAYOUT RESET --- */
        * { box-sizing: border-box; }

        body {
            margin: 0;
            height: 100vh; 
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            overflow: hidden; 
            display: flex;
            flex-direction: column; 
        }

        /* --- 1. THE FIXED HEADER --- */
        #sticky-header-group {
            flex: 0 0 auto; 
            background: #000;
            border-bottom: 1px solid #222;
            padding: 15px 20px;
            z-index: 50;
            position: relative; 
            
            /* Center the label */
            display: flex;
            justify-content: center; 
            align-items: center;
            min-height: 80px; 
        }

        /* Number/Arrow in Top Right */
        #display {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%); 
            
            font-size: 80px; 
            font-weight: bold;
            user-select: none;
            line-height: 1;
            white-space: nowrap; 
            text-align: right;
        }

        /* Centered Header */
        #slideLabel {
            background: transparent;
            border-bottom: 1px solid #333; 
            color: #ddd;
            font-size: 30px; 
            outline: none;
            padding-bottom: 2px;
            min-width: 200px;
            max-width: 60%; 
            text-align: center; 
            transition: border-color 0.2s;
            cursor: text;
        }
        #slideLabel:focus { border-bottom: 1px solid #fff; }

        /* --- 2. THE SCROLLING NOTES AREA --- */
        #notes-container {
            flex: 1; 
            position: relative;
            overflow: hidden; 
            display: flex;
            justify-content: center; 
        }

        #slideNotes {
            background: transparent;
            border: none;
            color: #aaa; 
            font-size: 18px; 
            text-align: left; 
            outline: none;
            font-family: 'Consolas', 'Courier New', monospace; 
            
            height: 100%; 
            width: 100%;
            max-width: 800px; 
            padding: 20px;
            overflow-y: auto; 
            
            white-space: pre-wrap; 
            line-height: 1.6;
        }
        
        #slideNotes::-webkit-scrollbar { width: 10px; }
        #slideNotes::-webkit-scrollbar-track { background: #111; }
        #slideNotes::-webkit-scrollbar-thumb { background: #333; border-radius: 5px; }
        #slideNotes::-webkit-scrollbar-thumb:hover { background: #555; }

        /* --- SETTINGS MENU --- */
        #menu-container { position: absolute; top: 10px; left: 10px; z-index: 100; }
        
        /* RESTORED: Clean Icon Style (No Box) */
        #gear-btn {
            background: transparent;
            color: #555; /* Darker grey when idle */
            border: none;
            font-size: 24px; /* Slightly larger */
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        #gear-btn:hover { 
            color: #fff; /* Just turns white, no border */
        }

        #controls-panel {
            display: none;
            margin-top: 5px;
            background: #111;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            flex-direction: column;
            gap: 15px;
            width: 220px;
        }
        #controls-panel.active { display: flex; }

        button.action-btn {
            padding: 8px;
            font-size: 12px;
            cursor: pointer;
            background: #000;
            color: #ddd;
            border: 1px solid #444;
            border-radius: 4px;
        }
        button.action-btn:hover { background: #222; }

        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; color: #888; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: #888; }
        #mode-status { color: #aaa; font-size: 12px; font-weight: bold; }
        #clear-data-btn { color: #ff4444; border-color: #552222; }

    </style>
</head>
<body>

    <div id="menu-container">
        <button id="gear-btn" onclick="toggleMenu()">âš™</button>
        <div id="controls-panel">
            <div class="control-group">
                <div id="mode-status">Mode: Slide Numbers</div>
                <button class="action-btn" onclick="toggleMode()">Switch Mode</button>
            </div>
            
            <div class="control-group">
                <label>Number Size</label>
                <input type="range" min="20" max="120" value="80" oninput="updateNumberSize(this.value)">
            </div>

            <div class="control-group">
                <label>Text Size</label>
                <input type="range" min="12" max="60" value="18" oninput="updateTextSize(this.value)">
            </div>

            <button id="clear-data-btn" class="action-btn" onclick="clearAllData()">Reset All</button>
        </div>
    </div>

    <div id="sticky-header-group">
        <div id="display">0</div>
        <span id="slideLabel" contenteditable="true" role="textbox"></span>
    </div>

    <div id="notes-container">
        <div id="slideNotes" contenteditable="true" role="textbox" data-placeholder="Start typing notes..."></div>
    </div>

    <script>
        // --- DATA STORAGE ---
        // Keeping same key so you don't lose data
        const savedData = localStorage.getItem('slideTrackerData_V7'); 
        
        let state = savedData ? JSON.parse(savedData) : {
            NUM: { count: 0, memory: {} },
            PULSE: { count: 0, memory: {} }
        };

        function saveData() {
            localStorage.setItem('slideTrackerData_V7', JSON.stringify(state));
        }

        // --- SETUP ---
        let currentMode = 'NUM'; 
        let timeoutHandle = null;

        const display = document.getElementById('display');
        const slideLabel = document.getElementById('slideLabel');
        const slideNotes = document.getElementById('slideNotes');
        const modeStatus = document.getElementById('mode-status');
        const controlsPanel = document.getElementById('controls-panel');

        updateDisplay(); 

        // --- MENU ---
        function toggleMenu() { controlsPanel.classList.toggle('active'); }

        // --- INPUT LOGIC ---
        function handleInput() {
            state[currentMode].memory[state[currentMode].count] = {
                header: slideLabel.innerText, 
                notes: slideNotes.innerText
            };
            saveData();
        }

        slideLabel.addEventListener('input', handleInput);
        slideNotes.addEventListener('input', handleInput);

        // Header: Enter = Blur
        slideLabel.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') { e.preventDefault(); slideLabel.blur(); }
        });

        // --- NAVIGATION LOGIC ---
        function handleNav(direction) {
            const activeState = state[currentMode];

            if (direction === 'forward') {
                activeState.count++;
                if (currentMode === 'PULSE') triggerFlash(">>>");
            } 
            else if (direction === 'backward') {
                if (activeState.count > 0) {
                    activeState.count--;
                    if (currentMode === 'PULSE') triggerFlash("<<<");
                }
            }

            saveData();
            updateDisplay();
        }

        function updateDisplay() {
            const activeState = state[currentMode];
            const data = activeState.memory[activeState.count] || {};

            slideLabel.innerText = data.header || "";
            slideNotes.innerText = data.notes || "";

            if (currentMode === 'NUM') {
                display.textContent = activeState.count;
                display.style.color = "white";
            } 
            else if (!timeoutHandle) {
                display.textContent = "---";
                display.style.color = "#333";
            }
        }

        function triggerFlash(symbol) {
            if (timeoutHandle) clearTimeout(timeoutHandle);
            display.textContent = symbol;
            display.style.color = "white"; 
            timeoutHandle = setTimeout(() => {
                display.textContent = "---";
                display.style.color = "#333"; 
                timeoutHandle = null;
            }, 500);
        }

        function toggleMode() {
            currentMode = (currentMode === 'NUM') ? 'PULSE' : 'NUM';
            modeStatus.textContent = (currentMode === 'NUM') ? "Mode: Slide Numbers" : "Mode: No Slide Numbers";
            if(timeoutHandle) { clearTimeout(timeoutHandle); timeoutHandle = null; }
            updateDisplay();
        }

        // --- DUAL SIZE UPDATERS ---
        function updateNumberSize(val) {
            display.style.fontSize = val + "px";
        }

        function updateTextSize(val) {
            slideNotes.style.fontSize = val + "px";
            slideLabel.style.fontSize = (val * 1.5) + "px";
        }

        function clearAllData() {
            if(confirm("Are you sure? This resets all slides and notes.")) {
                state = { NUM: { count: 0, memory: {} }, PULSE: { count: 0, memory: {} } };
                saveData();
                updateDisplay();
            }
        }

        // --- GLOBAL KEY LISTENER ---
        document.addEventListener('keydown', e => {
            
            // 1. ESC KEY
            if (e.key === 'Escape') {
                document.activeElement.blur();
                return;
            }

            // 2. CTRL/CMD + ARROW
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'ArrowUp' || e.key === 'ArrowRight') {
                    e.preventDefault(); 
                    handleNav('forward');
                    return;
                }
                if (e.key === 'ArrowDown' || e.key === 'ArrowLeft') {
                    e.preventDefault(); 
                    handleNav('backward');
                    return;
                }
            }

            // 3. Normal Behavior (Notes)
            if (document.activeElement === slideNotes) return;

            // 4. Header Navigation
            if (document.activeElement === slideLabel) {
                if (e.key === 'ArrowUp') { e.preventDefault(); handleNav('forward'); }
                else if (e.key === 'ArrowDown') { e.preventDefault(); handleNav('backward'); }
                return; 
            }

            // 5. Default Navigation
            if(e.key === 'ArrowUp' || e.key === 'ArrowRight') handleNav('forward');
            else if(e.key === 'ArrowDown' || e.key === 'ArrowLeft') handleNav('backward');
        });

    </script>
</body>
</html>